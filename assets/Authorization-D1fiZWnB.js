import{r as a,i as m,g as p,a as k,j as o,b as j,s as S}from"./index-D0o61ohh.js";import A from"./Loading-4ZeubAoS.js";function y({onLogin:d,onLogout:h}){const[c,f]=a.useState(()=>localStorage.getItem("access_token")||""),[u,t]=a.useState(!0);if(a.useEffect(()=>{const n=new URLSearchParams(window.location.search).get("code"),s=localStorage.getItem("access_token"),i=m();console.log("ðŸš€ useEffect triggered"),console.log("ðŸ”‘ code:",n),console.log("ðŸ’¾ existingToken:",s),console.log("âŒ› expired:",i);const l=async e=>{f(e),t(!1),d(e);const g=parseInt(localStorage.getItem("expires_in"),10);if(!isNaN(g)){const x=(g-Date.now())/1e3;S(x)}window.history.replaceState({},document.title,"/jammming/")};n&&!s?(console.log("getting token with code"),p(n).then(e=>{console.log("getting token:",e),e?l(e):t(!1)})):s&&!i?(console.log("reusing existing token"),l(s)):s&&i?(console.log("refreshing token..."),k().then(e=>{console.log("refreshed token response: ",e),e?l(e):t(!1)})):(console.log("no token found "),t(!1))},[]),u)return o.jsx(A,{});const r=!!(c&&c.trim()!=="");return console.log(r),o.jsx("div",{className:"displayAuthorization",children:r?o.jsxs("div",{className:"loggedIn",children:[o.jsx("h2",{children:"You are logged in!"}),o.jsx("button",{onClick:h,children:"Log Out"})]}):o.jsxs("div",{className:"needAuthorization",children:[o.jsx("h1",{children:"Spotify Authorization"}),o.jsx("button",{onClick:j,children:"Log in with Spotify"})]})})}export{y as default};
